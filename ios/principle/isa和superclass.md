# isaå’Œsuperclass

## ocå¯¹è±¡çš„åˆ†ç±»
ocå¯¹è±¡å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼Œ`instanceå¯¹è±¡ ï¼ˆå®ä¾‹å¯¹è±¡ï¼‰`ã€ `class å¯¹è±¡ ï¼ˆç±»å¯¹è±¡ï¼‰` å’Œ `meta-class å¯¹è±¡(å…ƒç±»å¯¹è±¡)`

æˆ‘ä»¬éƒ½çŸ¥é“å®ä¾‹å¯¹è±¡åœ¨å†…å­˜ä¸­ä¿å­˜ç€è‡ªå·±æˆå‘˜å˜é‡çš„å…·ä½“å€¼ï¼Œæ¯ä¸€ä¸ªé€šè¿‡`[[NSObject alloc] init]`è¿”å›çš„å®ä¾‹å¯¹è±¡çš„åœ°å€éƒ½ä¸ä¸€æ ·ã€‚ä½†æ˜¯ä»–ä»¬å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ isa æŒ‡é’ˆï¼Œè¿™ä¸ªisaæŒ‡é’ˆæ˜¯ä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿå¦å¤–æˆ‘ä»¬å¹³æ—¶ç”¨åˆ°åè®®åˆæ˜¯ä¿å­˜åˆ°ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿç­”æ¡ˆå°±åœ¨ç±»å¯¹è±¡ä¸­ã€‚

### ç±»å¯¹è±¡ class
é€šè¿‡ä¸‹é¢çš„ä»£ç è·å–åˆ°classå¯¹è±¡,é€šè¿‡æ‰“å°åœ°å€ï¼Œæˆ‘ä»¬å‘ç°å®ƒä»¬æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å€ã€‚**ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªç±»åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªclasså¯¹è±¡**ã€‚

**class å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ isaæŒ‡é’ˆã€superclassæŒ‡é’ˆã€ç±»çš„å±æ€§ä¿¡æ¯(@property)ã€ç±»çš„å¯¹è±¡æ–¹æ³•ä¿¡æ¯(instance method)ã€ç±»çš„åè®®ä¿¡æ¯(@protocol)ã€ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯(ivar) ...ç­‰ç­‰**,è¿™é‡Œçš„æˆå‘˜å˜é‡ä¿¡æ¯ä¸»è¦æŒ‡æˆå‘˜å˜é‡çš„ç±»å‹å’Œåå­—ï¼Œä¸æ˜¯å®ƒçš„å…·ä½“å€¼ã€‚

```objc
#import <objc/runtime.h>

NSObject *obj = [[NSObject alloc] init];

Class class1 = [obj class];
Class class2 = [NSObject class];
Class class3 = object_getClass(obj);

NSLog(@"%p %p %p",class1,class2,class3);
```

### å…ƒç±»å¯¹è±¡ meta-class
é€šè¿‡`object_getClass()`æ–¹æ³•ï¼Œå°†ç±»å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œä¼šè¿”å›å…ƒç±»å¯¹è±¡ã€‚ä½ ä¼šå‘ç°`å…ƒç±»å¯¹è±¡`å’Œ`ç±»å¯¹è±¡`ä¸€æ ·ï¼Œè¿”å›çš„éƒ½æ˜¯classç±»å‹ï¼Œè¯´æ˜ä»–ä»¬çš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯é‡Œé¢ä¿å­˜çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚

**æ¯ä¸ªå…ƒç±»å¯¹è±¡åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œä¸»è¦ä¿å­˜isaæŒ‡é’ˆã€superclassæŒ‡é’ˆã€ç±»çš„ç±»æ–¹æ³•ä¿¡æ¯ã€ç±»çš„å±æ€§ä¿¡æ¯(å€¼ä¸ºnull)ã€ç±»çš„åè®®ä¿¡æ¯(null) ...ç­‰ç­‰**ï¼Œè™½ç„¶å®ƒçš„ç»“æ„è·Ÿç±»å¯¹è±¡æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸»è¦ä¿å­˜çš„è¿˜æ˜¯isaã€superclasså’Œç±»çš„ç±»æ–¹æ³•ï¼Œå…¶ä»–ä¿¡æ¯éƒ½æ˜¯nullã€‚

```objc
// å°†ç±»å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ è¿›å»ï¼Œè·å–çš„æ˜¯å…ƒç±»å¯¹è±¡
class metaClass = object_getClass([NSObject class]);
// åˆ¤æ–­æ˜¯å¦æ˜¯å…ƒç±»
Bool isMetaClass = class_isMetaClass(metaClass);

```

## åˆå§‹ isa å’Œ superclass
æ ¹æ®æˆ‘ä»¬ä¸Šé¢çš„è®²è§£ï¼Œæ–¹æ³•æ˜¯ä¿å­˜åœ¨ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡ä¸­çš„ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒæ˜¯æ€ä¹ˆæ‰¾åˆ°è¿™äº›æ–¹æ³•å¹¶è¿è¡Œçš„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡isaå’Œsupperclassã€‚

isaæ˜¯æ€ä¹ˆæ‰¾åˆ°æ–¹æ³•çš„ï¼Œå¯ä»¥æ ¹æ®ä¸‹é¢çš„å›¾æ¥è®¤è¯†ä¸€ä¸‹ã€‚**å½“å®ä¾‹å¯¹è±¡è¦è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šé€šè¿‡å®ä¾‹å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è‡ªå·±çš„ç±»å¯¹è±¡ï¼Œç±»å¯¹è±¡å­˜å‚¨ç€å¯¹è±¡æ–¹æ³•ä¿¡æ¯ã€‚å¦‚æœæ˜¯è¦è°ƒç”¨ç±»æ–¹æ³•ï¼Œä¼šé€šè¿‡ ç±»å¯¹è±¡çš„isaæŒ‡é’ˆ æ‰¾åˆ°è‡ªå·±çš„ å…ƒç±»å¯¹è±¡è¿›è¡Œè°ƒç”¨ã€‚**(ä¸€ä¸ªæ˜¯ç±»å¯¹è±¡class,ä¸€ä¸ªæ˜¯å…ƒç±»å¯¹è±¡meta-classï¼ŒğŸ™…ä¸è¦ææ··å“ˆï¼ï¼)
![](./../imgs/ios_img_3.jpg)

å¦‚æœå­ç±»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œåˆæ˜¯å¦‚ä½•æ‰¾åˆ°çš„å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº†æˆ‘ä»¬çš„ superclassæŒ‡é’ˆ ã€‚å› ä¸ºç±»å¯¹è±¡çš„ superclassæŒ‡é’ˆ å’Œå…ƒç±»å¯¹è±¡çš„ superclassæŒ‡é’ˆ æŒ‡å‘çš„ç±»ä¸åŒï¼Œæ‰€ä»¥è¿™é‡Œå…ˆè®²ä¸€ä¸‹ç±»å¯¹è±¡çš„ superclassæŒ‡é’ˆã€‚

> ç±»å¯¹è±¡ çš„superclassæŒ‡é’ˆ

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Personç±» ç»§æ‰¿è‡ª NSObject , ä¸€ä¸ªStudentç±»ç»§æ‰¿è‡ªPersonç±»ã€‚superclassæŒ‡é’ˆçš„æŒ‡å‘å¦‚å›¾æ‰€ç¤ºã€‚**ç±»å¯¹è±¡çš„ superclassæŒ‡é’ˆ æŒ‡å‘çš„æ˜¯ çˆ¶ç±»çš„ç±»å¯¹è±¡ï¼Œå½“Studentçš„å®ä¾‹å¯¹è±¡è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œä¼šå…ˆé€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°è‡ªå·±çš„ç±»å¯¹è±¡ï¼Œç„¶åé€šè¿‡ç±»å¯¹è±¡çš„superclassæŒ‡é’ˆ æ‰¾åˆ°Personçš„ç±»å¯¹è±¡ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚**
![](./../imgs/ios_img_4.jpg)

> å…ƒç±»å¯¹è±¡ çš„superclassæŒ‡é’ˆ

åŒä¸Šæ‰€è¿°ï¼Œ**å…ƒç±»å¯¹è±¡çš„superlcassæŒ‡é’ˆ æŒ‡å‘çš„æ˜¯è‡ªå·±çˆ¶ç±»çš„å…ƒç±»å¯¹è±¡ã€‚**å½“Studentè°ƒç”¨Personç±»çš„ç±»æ–¹æ³•æ—¶ï¼Œä¼šå…ˆé€šè¿‡ç±»å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è‡ªå·±çš„å…ƒç±»å¯¹è±¡ï¼Œç„¶åé€šè¿‡å…ƒç±»å¯¹è±¡çš„ superclassæŒ‡é’ˆ æ‰¾åˆ°Personçš„å…ƒç±»å¯¹è±¡è¿›è¡Œè°ƒç”¨ã€‚

![](./../imgs/ios_img_5.jpg)

## é€šè¿‡ä¸€å¼ å›¾æ¥å†æ¬¡è®¤è¯†isaå’Œsuperclass
å›¾ä¸­æœ‰ä¸‰ä¸ªç±»ï¼Œå­ç±»ã€çˆ¶ç±»ã€åŸºç±»ï¼Œé€šè¿‡superclassè¿æ¥åœ¨ä¸€èµ·ã€‚è¿˜æœ‰ä¸‰ç§å¯¹è±¡ç±»å‹ï¼Œå®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡ã€å…ƒç±»å¯¹è±¡ï¼Œé€šè¿‡isaè¿æ¥åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬çœ‹æˆæˆ‘ä»¬åˆšæ‰è®²çš„Studentç±»ã€Personç±»ã€NSObjectç±»ã€‚è™šçº¿æ˜¯isaï¼Œå®çº¿æ˜¯superclassã€‚

![](./../imgs/ios_img_6.jpg)

é€šè¿‡è¿™å¼ å›¾æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªæ€»ç»“ï¼š
1. instanceçš„isaæŒ‡å‘class, classçš„isaæŒ‡å‘meta-calss, meta-calssçš„isaæŒ‡å‘åŸºç±»çš„meta-calss

2. classçš„ superclassæŒ‡é’ˆ æŒ‡å‘çˆ¶ç±»çš„classï¼Œå¦‚æœæ²¡æœ‰çˆ¶ç±»ï¼ŒæŒ‡å‘nil
3. meta-calssçš„ superclassæŒ‡é’ˆ æŒ‡å‘çˆ¶ç±»çš„meta-calssï¼Œ**åŸºç±»çš„meta-calssçš„ superclassæŒ‡é’ˆ æŒ‡å‘ åŸºç±»çš„class**

å®ä¾‹å¯¹è±¡è°ƒç”¨æ–¹æ³•çš„è½¨è¿¹ï¼šinstanceé€šè¿‡isaæ‰¾åˆ°class,å¦‚æœæ–¹æ³•ä¸å­˜åœ¨ï¼Œé€šè¿‡superclassæ‰¾åˆ°çˆ¶ç±»

classè°ƒç”¨ç±»æ–¹æ³•çš„è½¨è¿¹ï¼šclassé€šè¿‡isaæ‰¾åˆ°meta-class,å¦‚æœæ–¹æ³•ä¸å­˜åœ¨ï¼Œé€šè¿‡superclassæ‰¾åˆ°çˆ¶ç±»ï¼Œå¦‚æœ

>åŸºç±»çš„å…ƒç±»å¯¹è±¡çš„superlcassæŒ‡å‘åŸºç±»çš„ç±»å¯¹è±¡ã€‚
è¿™é‡Œæˆ‘ä»¬è‚¯å®šä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œè¿™æ˜¯çœŸçš„å—ï¼Ÿæˆ‘ä»¬å°†é€šè¿‡ä¸‹é¢çš„ä»£ç è¿›è¡Œè¯å®ã€‚

```objc
// Person ç»§æ‰¿è‡ª NSObject,åŒæ—¶æ·»åŠ äº† metaTestç±»æ–¹æ³• ,ä½†å¹¶æ²¡æœ‰å¯¹å®ƒå®ç°ã€‚é€šè¿‡æ·»åŠ NSObjectåˆ†ç±»å®ç°äº†- (void)metaTest{}æ–¹æ³•ã€‚ç›´æ¥è°ƒç”¨[Person metaTest]å‘ç°å¯ä»¥å‘ç°metaTestæ–¹æ³•ã€‚
@interface Person : NSObject
+ (void)metaTest;
@end

@implementation Person

@end

@interface NSObject (Test)
+ (void)metaTest;
@end

@implementation NSObject (Test)
// å®ä¾‹æ–¹æ³•
- (void)metaTest{
    NSLog(@"[NSObject test] -- %p",self);
}
@end

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        NSLog(@"Person :%p -- NSObject :%p",[Person class],[NSObject class]);
        [Person metaTest];
        [NSObject metaTest];
    }
    return 0;
}
```
è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å‘ç°Personç±»çœŸçš„å¯ä»¥æ‰ç”¨`metaTest`æ–¹æ³•ï¼ŒæŒ‰ç…§æˆ‘ä»¬åˆšæ‰æ‰€å­¦ï¼Œå®ƒçš„è°ƒç”¨é¡ºåºåº”è¯¥å¦‚ä¸‹å›¾æ‰€ç¤º
![ios_img_7](./../imgs/ios_img_7.jpg)

## isaçš„éªŒè¯è¿‡ç¨‹
æˆ‘ä»¬åˆšæ‰æ‰€è¯´ï¼ŒisaæŒ‡é’ˆæŒ‡å‘çš„å°±æ˜¯ç±»å¯¹è±¡ï¼Œæˆ‘ä»¬é€šè¿‡ç›´æ¥æ‰“å°åœ°å€çš„æ–¹å¼è¿›è¡ŒéªŒè¯ã€‚



## æ‰©å±•
é¢è¯•é¢˜: å¯¹è±¡çš„isaæŒ‡å‘å“ªé‡Œ

å½“ä¸€ä¸ªå®ä¾‹å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œæœ¬è´¨æ˜¯é€šè¿‡runtimeæ–¹æ³•ç»™ç±»å‘é€æ¶ˆæ¯ï¼Œå®ä¾‹å¯¹è±¡æœ¬èº«æ²¡æœ‰æ–¹æ³•ï¼Œé€šè¿‡è‡ªèº«isaæŒ‡é’ˆæ‰¾åˆ°ç±»å¯¹è±¡ï¼Œè°ƒç”¨ç±»å¯¹è±¡ä¸­ä¿å­˜çš„æ–¹æ³•ã€‚


object_getClass(id obj)
objc_getClass(const char *aClassName)
çš„åŒºåˆ«
```cpp
// objc-class.mm
Class object_getClass(id obj)
{
    // å¦‚æœæ˜¯instanceå¯¹è±¡ï¼Œè¿”å›çš„æ˜¯classå¯¹è±¡
    // å¦‚æœæ˜¯classå¯¹è±¡ï¼Œè¿”å›çš„æ˜¯meta-classå¯¹è±¡
    // å¦‚æœæ˜¯meta-classå¯¹è±¡ï¼Œè¿”å›çš„æ˜¯NSOject(åŸºç±»)çš„meta-classå¯¹è±¡
    if (obj) return obj->getIsa();
    else return Nil;
}

/***********************************************************************
* objc_getClass.  Return the id of the named class.  If the class does
* not exist, call _objc_classLoader and then objc_classHandler, either of 
* which may create a new class.
* Warning: doesn't work if aClassName is the name of a posed-for class's isa!
**********************************************************************/
Class objc_getClass(const char *aClassName)
{
    if (!aClassName) return Nil;

    // NO unconnected, YES class handler
    return look_up_class(aClassName, NO, YES);
}

+ (Class)class
- (Class)class
è¿”å›çš„ä¸€ç›´éƒ½æ˜¯ç±»å¯¹è±¡ã€‚
```